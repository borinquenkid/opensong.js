/*! opensong - v0.0.0-ignored - 2012-11-25
 * https://github.com/deepflame/opensong.js
 * Copyright (c) 2012 Andreas Boehrnsen; Licensed LGPL 2.1
 */
var opensong;opensong=opensong||{},opensong.helper=opensong.helper||{},opensong.Song=function(){function t(t,n){this.el=e(t),this.tpl=function(){var e;return e="{{#this}}\n<h2>{{human_header header}}</h2>\n  {{#lines}}\n<table>\n  <tr class=\"chords\">\n    {{#chords}}\n    <td>{{transpose this}}</td>\n    {{/chords}}\n  </tr>\n    {{#lyrics}}\n  <tr class='lyrics'>\n      {{#this}}\n    <td>{{this}}</td>\n      {{/this}}\n  </tr>\n    {{/lyrics}}\n</table>\n  {{/lines}}\n{{/this}}",Handlebars.compile(e)}(),this.setLyrics(n)}var e;return t.prototype.transpose=function(e){return Handlebars.registerHelper("transpose",function(t){return opensong.helper.transposeChord(t,e||0)}),this.renderLyrics()},t.prototype.setLyrics=function(e){return this.model=opensong.helper.parseLyrics(e),this.renderLyrics()},t.prototype.renderLyrics=function(){this.el.innerHTML=this.tpl(this.model);if(!/opensong/.test(this.el.className))return this.el.className+=" opensong"},e=function(e){return typeof e=="string"?document.getElementById(e):e.jquery?e.get(0):e.nodeType?e:void 0},Handlebars.registerHelper("human_header",function(e){return opensong.helper.humanizeHeader(e)}),Handlebars.registerHelper("transpose",function(e){return e}),t}(),opensong.helper.transposeChord=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B","C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],f=[],p=e.split("/");for(c=0,h=p.length;c<h;c++){n=p[c],u=/^([A-G][#b]?)(.*)$/.exec(n);if(!u)return e;l=u[0],i=u[1],r=u[2],o=s.indexOf(i);if(o<0){f.push(n);continue}a=(o+t+s.length)%(s.length/2),f.push(s[a]+r)}return f.join("/")},opensong.helper.humanizeHeader=function(e){var t,n;return t=/([a-zA-Z]+)(\d*)/.exec(e).slice(1),n=t[0],t[0]=function(){switch(n){case"C":return"Chorus";case"V":return"Verse";case"B":return"Bridge";case"T":return"Tag";case"P":return"Pre-Chorus";default:return n}}(),t[1]===""&&t.pop(),t.join(" ")},opensong.helper.parseLyrics=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;c=e.split("\n"),o=[];while(c.length>0){l=c.shift();if(l==null)continue;switch(l[0]){case"[":a=l.match(/\[(.*)\]/)[1],u={header:a,lines:[]},o.push(u);break;case".":i=l.substr(1),t=[];while(i.length>0)h=/^(\S*\s*)(.*)$/.exec(i),t.push(h[1]),i=h[2];t.length===0&&t.push(i),n=[],$.each(t,function(e,t){return h=/(\S*\s?)\s*/.exec(t),n.push(h[1])}),d="",h=null,s=/_|\||---|-!!/g,v=[];while((d=c.shift())&&(h=d.match(/^([ 1-9])(.*)/))){p=[],m=h[1],d=h[2];for(f in t)f<t.length-1?(r=t[f].length,h=d.match(new RegExp("(.{0,"+r+"})(.*)")),p.push(h[1].replace(s,"")),d=h[2]):p.push(d.replace(s,""));v.push(p)}u.lines.push({chords:n,lyrics:v}),d!=="undefined"&&c.unshift(d);break;case" ":u.lines.push({lyrics:l.substr(1)});break;case";":u.lines.push({comments:l.substr(1)});break;default:typeof console!="undefined"&&console!==null&&console.log("no support for: "+l)}}return o};